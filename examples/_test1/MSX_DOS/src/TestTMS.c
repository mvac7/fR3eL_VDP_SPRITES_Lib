/* =============================================================================
   Test VDP_TMS9918A 
   v1.2 (26/04/2019)
   Description:
     test VDP TMS9918 Librarie (VDP_TMS9918_DOS)
     source for MSX-DOS
   v1.1 (23/03/2017)
============================================================================= */

#include "../include/newTypes.h"
#include "../include/msxBIOS.h"
#include "../include/msxDOS.h"
#include "../include/msxSystemVariables.h"

#include "../include/VDP_TMS9918A.h"



#define  HALT __asm halt __endasm   //wait for the next interrupt



// Definitions of Labels -------------------------------------------------------
#define  SYSTEM 0x0005




//  definition of functions  ---------------------------------------------------
void System(char code);

void WAIT(uint cicles);
char INKEY();

void SCREEN0();
void SCREEN1();


char PEEK(uint address);
void POKE(uint address, char value);

void CLS();

void VPRINT(char column, char line, char* text);  //print in screen 1 or 2
void VPRINT0(char column, char line, char* text);
void VPOKEARRAY(uint vaddr, char* text);

void LOCATE(char x, char y);
void PRINT(char* text);

void testSCREEN0();
void testSCREEN1();
void testSCREEN2();
void testSCREEN3();

void testFill();
void testColor();
void testVpeekVpoke();

void test_Sprites();
void showSprites(char offset);
void PUTSPRITE(char plane, char x, char y, char color, char pattern);
char isSPRITE16px();


// constants  ------------------------------------------------------------------

const char text01[] = "Test SDCC VDP_TMS9918A\n\r"; 
const char text02[] = "v1.2 (26/04/2019)\n\r";
const char text03[] = "Press any key to continue";




// tileset pattern
// Tiles range: 0 to 127
// Size= 1024
const char TILESET[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xAA,0x55,0xAA,0x55,0xAA,0x55,0xAA,0x55,0x00,0x01,0x03,0x07,0x0F,0x1F,0x3F,0x7F,
0x80,0xC0,0xE0,0xF0,0xF8,0xFC,0xFE,0xFF,0x7F,0x3F,0x1F,0x0F,0x07,0x03,0x01,0x00,
0xFF,0xFE,0xFC,0xF8,0xF0,0xE0,0xC0,0x80,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,
0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x18,0xFF,0xFF,0x00,0x00,0x00,
0x00,0x00,0x00,0xFF,0xFF,0x18,0x18,0x18,0x18,0x18,0x18,0xF8,0xF8,0x18,0x18,0x18,
0x18,0x18,0x18,0x1F,0x1F,0x18,0x18,0x18,0x18,0x18,0x18,0xFF,0xFF,0x18,0x18,0x18,
0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0x1F,0x18,0x18,0x18,0x00,0x00,0x00,0xF0,0xF8,0x18,0x18,0x18,
0x18,0x18,0x18,0x1F,0x0F,0x00,0x00,0x00,0x18,0x18,0x18,0xF8,0xF0,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x0C,0x0C,0x00,0x0C,0x00,
0x00,0x14,0x14,0x00,0x00,0x00,0x00,0x00,0x00,0x14,0x3E,0x14,0x3E,0x14,0x00,0x00,
0x08,0x3E,0x68,0x3E,0x0B,0x3E,0x08,0x00,0x00,0x33,0x36,0x0C,0x1B,0x33,0x00,0x00,
0x00,0x38,0x6C,0x3D,0x66,0x3D,0x00,0x00,0x00,0x18,0x30,0x00,0x00,0x00,0x00,0x00,
0x06,0x0C,0x0C,0x0C,0x0C,0x0C,0x06,0x00,0x30,0x18,0x18,0x18,0x18,0x18,0x30,0x00,
0x00,0x5A,0x3C,0x7E,0x3C,0x5A,0x00,0x00,0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00,
0x00,0x00,0x00,0x00,0x18,0x18,0x10,0x00,0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x06,0x0C,0x18,0x30,0x60,0x00,0x00,
0x00,0x3E,0x63,0x63,0x63,0x3E,0x00,0x00,0x00,0x18,0x38,0x18,0x18,0x3C,0x00,0x00,
0x00,0x7E,0x03,0x3E,0x60,0x7F,0x00,0x00,0x00,0x7E,0x03,0x1E,0x03,0x7E,0x00,0x00,
0x00,0x63,0x63,0x7F,0x03,0x03,0x00,0x00,0x00,0x7F,0x60,0x7E,0x03,0x7E,0x00,0x00,
0x00,0x3E,0x60,0x7E,0x63,0x3E,0x00,0x00,0x00,0x7F,0x03,0x06,0x0C,0x0C,0x00,0x00,
0x00,0x3E,0x63,0x3E,0x63,0x3E,0x00,0x00,0x00,0x3E,0x63,0x3F,0x03,0x3E,0x00,0x00,
0x00,0x18,0x18,0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x00,0x18,0x18,0x10,0x00,
0x00,0x0C,0x18,0x30,0x18,0x0C,0x00,0x00,0x00,0x00,0x3C,0x00,0x3C,0x00,0x00,0x00,
0x00,0x30,0x18,0x0C,0x18,0x30,0x00,0x00,0x00,0x1E,0x33,0x06,0x0C,0x00,0x0C,0x00,
0x3E,0x41,0x5D,0x55,0x5F,0x40,0x3E,0x00,0x00,0x3E,0x63,0x7F,0x63,0x63,0x00,0x00,
0x00,0x7E,0x63,0x7E,0x63,0x7E,0x00,0x00,0x00,0x3F,0x60,0x60,0x60,0x3F,0x00,0x00,
0x00,0x7E,0x63,0x63,0x63,0x7E,0x00,0x00,0x00,0x7F,0x60,0x7C,0x60,0x7F,0x00,0x00,
0x00,0x7F,0x60,0x7C,0x60,0x60,0x00,0x00,0x00,0x3F,0x60,0x67,0x63,0x3F,0x00,0x00,
0x00,0x63,0x63,0x7F,0x63,0x63,0x00,0x00,0x00,0x0C,0x0C,0x0C,0x0C,0x0C,0x00,0x00,
0x00,0x0C,0x0C,0x0C,0x0C,0x38,0x00,0x00,0x00,0x63,0x66,0x7C,0x66,0x63,0x00,0x00,
0x00,0x60,0x60,0x60,0x60,0x7F,0x00,0x00,0x00,0x63,0x77,0x7F,0x6B,0x63,0x00,0x00,
0x00,0x63,0x73,0x7B,0x6F,0x67,0x00,0x00,0x00,0x3E,0x63,0x63,0x63,0x3E,0x00,0x00,
0x00,0x7E,0x63,0x63,0x7E,0x60,0x00,0x00,0x00,0x3E,0x63,0x6B,0x66,0x3D,0x00,0x00,
0x00,0x7E,0x63,0x63,0x7E,0x63,0x00,0x00,0x00,0x3F,0x60,0x3E,0x03,0x7E,0x00,0x00,
0x00,0x7E,0x18,0x18,0x18,0x18,0x00,0x00,0x00,0x63,0x63,0x63,0x63,0x3E,0x00,0x00,
0x00,0x63,0x63,0x63,0x36,0x1C,0x00,0x00,0x00,0x63,0x6B,0x7F,0x77,0x63,0x00,0x00,
0x00,0x63,0x36,0x1C,0x36,0x63,0x00,0x00,0x00,0x66,0x66,0x3C,0x18,0x18,0x00,0x00,
0x00,0x7E,0x0C,0x18,0x30,0x7E,0x00,0x00,0x0E,0x0C,0x0C,0x0C,0x0C,0x0C,0x0E,0x00,
0x00,0x60,0x30,0x18,0x0C,0x06,0x00,0x00,0x38,0x18,0x18,0x18,0x18,0x18,0x38,0x00,
0x10,0x38,0x6C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x03,0x3F,0x63,0x7F,0x00,0x00,
0x60,0x7E,0x63,0x63,0x63,0x7E,0x00,0x00,0x00,0x3F,0x60,0x60,0x60,0x3F,0x00,0x00,
0x03,0x3F,0x63,0x63,0x63,0x3F,0x00,0x00,0x00,0x3E,0x63,0x7F,0x60,0x3E,0x00,0x00,
0x00,0x3E,0x60,0x78,0x60,0x60,0x00,0x00,0x00,0x3E,0x63,0x63,0x3F,0x03,0x3E,0x00,
0x60,0x7E,0x63,0x63,0x63,0x63,0x00,0x00,0x0C,0x00,0x0C,0x0C,0x0C,0x0C,0x00,0x00,
0x0C,0x00,0x0C,0x0C,0x0C,0x0C,0x38,0x00,0x00,0x60,0x66,0x7C,0x66,0x63,0x00,0x00,
0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00,0x7E,0x6B,0x6B,0x6B,0x6B,0x00,0x00,
0x00,0x7E,0x63,0x63,0x63,0x63,0x00,0x00,0x00,0x3E,0x63,0x63,0x63,0x3E,0x00,0x00,
0x00,0x7E,0x63,0x63,0x63,0x7E,0x60,0x00,0x00,0x3F,0x63,0x63,0x63,0x3F,0x03,0x00,
0x00,0x3F,0x60,0x60,0x60,0x60,0x00,0x00,0x00,0x3F,0x60,0x3E,0x03,0x7E,0x00,0x00,
0x18,0x3E,0x18,0x18,0x18,0x0E,0x00,0x00,0x00,0x63,0x63,0x63,0x63,0x3E,0x00,0x00,
0x00,0x63,0x63,0x63,0x36,0x1C,0x00,0x00,0x00,0x63,0x6B,0x6B,0x6B,0x36,0x00,0x00,
0x00,0x66,0x3C,0x18,0x3C,0x66,0x00,0x00,0x00,0x63,0x63,0x63,0x3F,0x03,0x3E,0x00,
0x00,0x7E,0x0C,0x18,0x30,0x7E,0x00,0x00,0x06,0x0C,0x0C,0x18,0x0C,0x0C,0x06,0x00,
0x18,0x18,0x18,0x00,0x18,0x18,0x18,0x00,0x30,0x18,0x18,0x0C,0x18,0x18,0x30,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};


const char sprcol[8]={12,2,3,7,6,8,9,14};

const char SPRITE_DATA[]={
60,66,165,129,165,153,66,60,
60,126,219,255,255,219,102,60,
108,254,254,254,124,56,16,0,
16,56,124,254,124,56,16,0,
16,56,84,254,84,16,56,0,
16,56,124,254,254,16,56,0,
0,0,0,24,24,0,0,0,
255,255,255,231,231,255,255,255,
15,31,61,63,123,124,191,191,159,239,111,31,15,5,5,29,
192,224,96,192,64,128,128,132,134,222,192,192,128,0,0,192,
5,7,26,46,111,91,92,91,95,88,111,45,22,2,2,6,
64,192,184,212,212,106,234,106,234,106,212,212,248,64,64,96,
3,7,79,207,77,79,44,30,63,63,63,63,31,2,2,6,
192,226,230,226,162,244,56,124,254,254,254,252,248,64,64,96,
5,30,63,111,87,110,63,0,7,5,7,4,6,3,2,6,
96,248,244,234,118,190,124,0,224,96,224,32,96,192,64,96,
5,7,31,63,127,127,127,125,127,127,120,63,31,4,4,12,
64,192,240,248,252,252,252,124,252,252,60,248,240,64,64,96,
7,31,63,63,127,113,127,127,127,126,62,63,31,7,2,6,
224,248,252,252,254,142,254,254,254,126,124,252,248,224,64,96,
0,7,31,63,127,113,255,255,123,124,63,31,7,2,2,6,
0,224,248,252,254,142,255,255,222,62,252,248,224,64,64,96,
5,30,63,111,87,110,63,0,7,5,7,4,6,3,2,6,
96,248,244,234,118,190,124,0,224,96,224,32,96,192,64,96
};



// Functions -------------------------------------------------------------------


//
void main(void)
{
  char colorInk=0;
  char colorBG=0;
  char colorBDR=0;
  char scrcolumns=0;
  
  colorInk=PEEK(FORCLR);
  colorBG=PEEK(BAKCLR);
  colorBDR=PEEK(BDRCLR);
  scrcolumns=PEEK(LINLEN);


  //HALT;
  PRINT(text01); 
  PRINT(text02);
  PRINT(text03);
  INKEY();
  
//TEST -------------------------------------------------------------------------   
  
  testColor();
  WAIT(100);
 
  testSCREEN0();  
  WAIT(100);



  
  testSCREEN1();  
  WAIT(100);

  
  test_Sprites();
  WAIT(100);


  
  testSCREEN2();  
  WAIT(100);
  
  testSCREEN3();  
  WAIT(100);
  


//EXIT MSXDOS ------------------------------------------------------------------
  //put the screen as it was.
  COLOR(colorInk,colorBG,colorBDR);
//  WIDTH(scrcolumns);

  if(scrcolumns<33) SCREEN1();
  else SCREEN0();
  //
  
  PRINT("END Test");
    
  System(_TERM0); 
//--------------------------------------------------------------------- end EXIT   
}



void System(char code)
{
code;
__asm
	push IX
	ld IX,#0
	add IX,SP

	ld C,4(ix)
	call SYSTEM

	pop IX
__endasm; 
}



void SCREEN0()
{
__asm

  push IX
  
  ld   A,(#LINLEN)
  ld   (#LINL40),A   ;copy columns seting with WIDTH to LINL40 system var
   
  ld   IX,#INITXT
  ld   IY,(EXPTBL-1)
  call CALSLT
  ei
    
  pop  IX
  
__endasm;
}



void SCREEN1()
{
__asm
     
  push IX
  
  ld   A,(#LINLEN)   ;get a last value set with WIDTH function 
  ld   (#LINL32),A   ;set system variable
   
  ld   IX,#INIT32
  ld   IY,(EXPTBL-1)
  call CALSLT
  ei
    
  pop  IX
  
__endasm;
}



/* =============================================================================
One character input (waiting)
============================================================================= */
char INKEY(){
__asm
  push IX
  ld   IX,#0
  add  IX,SP
    
  ;call CHGET
  ld   IX,#CHGET
  ld   IY,(#EXPTBL-1)
  call CALSLT ;acces to MSX BIOS
  
  ld   L,A
  pop  IX
__endasm;
}



// Generates a pause in the execution of n interruptions.
// PAL: 50=1second. ; NTSC: 60=1second. 
void WAIT(uint cicles)
{
  uint i;
  for(i=0;i<cicles;i++) HALT;
  return;
}



char PEEK(uint address)
{
address;
__asm
  push IX
  ld   IX,#0
  add  IX,SP
    
  ld   L,4(ix)
  ld   H,5(ix)
  ld   A,(hl)

  ld   L,A

  pop  IX
__endasm;
}



void POKE(uint address, char value)
{
address;value;
__asm
  push IX
  ld   IX,#0
  add  IX,SP 
    
  ld   L,4(ix)
  ld   H,5(ix)
  ld   A,6(ix)
  ld   (HL),A

  pop  IX  
__endasm;
}



void CLS()
{
  FillVRAM(BASE10, 0x300, 32);
}


//print in screen 1 or 2
void VPRINT(char column, char line, char* text)
{
  uint vaddr = BASE10 + (line*32)+column; // calcula la posicion en la VRAM
  VPOKEARRAY(vaddr, text);
}



//print in screen 0
void VPRINT0(char column, char line, char* text)
{
  uint vaddr = BASE0 + (line*40)+column; // calcula la posicion en la VRAM
  VPOKEARRAY(vaddr, text);
}



void VPOKEARRAY(uint vaddr, char* text)
{
  while(*(text)) VPOKE(vaddr++,*(text++));
}






/* =============================================================================
   Set a position the cursor in to the specified location
   Posiciona el cursor hasta la ubicacion especificada
   x(byte) - column (0 to 31 or 39)
   y(byte) - line   (0 to 23)
============================================================================= */
void LOCATE(char x, char y)
{
x;y;
__asm
  push IX
  ld   IX,#0
  add  IX,SP
  
  ld   A,4(IX) ;x
  inc  A       ;incrementa las posiciones para que se situen correctamente en la pantalla
  ld   H,A
  ld   A,5(IX) ;y
  inc  A
  ld   L,A
     
  ;call POSIT
  ld   IX,#POSIT
  ld   IY,(#EXPTBL-1)
  call CALSLT ;acces to MSX BIOS
  
  pop  IX
__endasm;

}



/* =============================================================================
   Print a text in screen
============================================================================= */
void PRINT(char* text)
{ 
text;
__asm
  push IX
  ld   IX,#0
  add  IX,SP
  
  ld   L,4(ix)
  ld   H,5(ix)
  
nextCHAR:  
  ld   A,(HL)
  or   A
  jr   Z,ENDnext
     
  ;call CHPUT //Displays one character (BIOS)
  ld   IX,#CHPUT
  ld   IY,(#EXPTBL-1)
  call CALSLT ;acces to MSX BIOS
  
  inc  HL
  jr   nextCHAR
ENDnext:  
  pop  IX
__endasm; 
}



// TEST SCREEN 0 ###############################################################
void testSCREEN0()
{
  byte i;
  
  COLOR(0,DARK_GREEN,WHITE);    
  SCREEN(0);

  VPRINT0(31,23," SCREEN 0");
  WAIT(50);
  
  for(i=0;i<255;i++) VPOKE(BASE0+i,i);
  WAIT(50);
  
  testVpeekVpoke();
  WAIT(50);
  
  //testFill
  VPRINT0(0,0,"FillVRAM()");
  for(i=32;i<95;i++)
  {
    HALT;
    HALT;
    HALT;
    HALT;
    
    FillVRAM (BASE0+10, 942, i);    
  }
  
}



// TEST SCREEN 1 ###############################################################
void testSCREEN1()
{
  char i;
  
  COLOR(0,5,1);    
  SCREEN(1);
  
  CopyToVRAM((uint) TILESET,BASE7,128*8); 
  
  VPRINT(23,23," SCREEN 1");
  WAIT(50);
  
  for(i=0;i<255;i++) VPOKE(BASE5+i,i);
  WAIT(50);
  
  //VPRINT(0,10,"Test CopyToVRAM()");
  //copy to VRAM tileset, only gfx patterns
  //CopyToVRAM((uint) TILESET,BASE12,128*8); 
  //WAIT(50);
  

   
  /* colors
  The BG Colors array defines 32 colors (each 4 bit background, and 4 bit 
  foreground, as in VDP register 7). The colors are assigned to the BG Tiles as
  follows: Tiles 00..07 share the first color, tiles 08..0F share the second 
  color, etc, and tiles F8..FF share the last color.*/
  FillVRAM(BASE6,32,0x75);
  
  WAIT(50);
  
  testFill();
  
}



// TEST SCREEN 2 ###############################################################
void testSCREEN2()
{
  unsigned int i;
  char value=0;
  
  COLOR(0,4,1);    
  SCREEN(2);
    
  for(i=0;i<0x300;i++) VPOKE(BASE10+i,value++);  //name table in order
    

  VPRINT(23,23," SCREEN 2");
    
  
  //copy to VRAM tileset, only gfx patterns and fill colors
  //bank 0
  HALT;
  CopyToVRAM((uint) TILESET,BASE12,128*8);
  FillVRAM(BASE11,128*8,0x96); //colors (Red)
    
  //bank 1
  CopyToVRAM((uint) TILESET,BASE12+BANK1,128*8);
  FillVRAM(BASE11+BANK1,128*8,0x3C); //colors (green)
  
  //bank 2
  CopyToVRAM((uint) TILESET,BASE12+BANK2,128*8);
  FillVRAM(BASE11+BANK2,128*8,0x54); //colors (blue)
  WAIT(50);
  //END copy
  
  
  //test CopyFromVRAM
  VPRINT(0,5,"Test CopyFromVRAM()");
  //copy VRAM to RAM
  CopyFromVRAM(BASE12+(32*8),0xE000,64*8);
  WAIT(50);
  
  //copy RAM to VRAM
  CopyToVRAM(0xE000,BASE12+0x600,64*8);   
  FillVRAM(BASE11+0x600,64*8,0xFE); //colors
  WAIT(120);
  //END CopyFromVRAM
  
  
  //test fill VRAM  
  testFill();

}



// TEST SCREEN 3 ###############################################################
void testSCREEN3()
{
  char value=0;
  uint i;
  
  COLOR(0,4,4);
  SCREEN(1);
  
  FillVRAM(BASE6, 32, 0xE4);
  CopyToVRAM((uint) TILESET,BASE7,128*8);
  
  VPRINT(10,10,"Test SCREEN 3");

  WAIT(200);
  
  
  FillVRAM(BASE17, 0x800, 0); //clear screen 3 pattern table  
  SCREEN(3);
  
  for(i=0;i<0x300;i++) VPOKE(BASE15+i,value++);  //name table in order
  
  value=0;
  for(i=0;i<0x800;i++) VPOKE(i,value++);

  WAIT(250);

}





// TEST COLOR  #################################################################
void testColor()
{
  char i;

  SCREEN(0);
  COLOR(0,0,4);

  VPRINT0(15,10,"Test COLOR");
  WAIT(50);
  
  for(i=0;i<16;i++)
  { 
    COLOR(0,i,15-i);
        
    WAIT(15);
  }  
}



// TEST VPEEK & VPOKE  #########################################################
// copy a bloq using vpeek and vpoke
void testVpeekVpoke()
{
  uint vaddr = BASE0;
  byte i;
  byte value;
  
  VPRINT0(0,9,"Test VPEEK and VPOKE:");
  
  for(i=0;i<255;i++)
  {
    HALT;
    value = VPEEK(vaddr);
    VPOKE(vaddr+440,value);
    vaddr++;  
  }  

}



// TEST FILL  ##################################################################
//fill screen map with a characters range 
void testFill()
{
  byte i;

  VPRINT(0,0,"FillVRAM()");
  for(i=32;i<95;i++)
  {
    HALT;
    HALT;
    HALT;
    HALT;
    
    FillVRAM (BASE10+10, 750, i);    
  }  
  
}


// TEST Sprites ################################################################
void test_Sprites()
{

  FillVRAM (BASE10, 760, 0);
  VPRINT(0,0, "Test Sprites");  
  
  CopyToVRAM((uint) SPRITE_DATA,BASE14,32*14);
  
  WAIT(50);
  
  // sprites 8x8
  //setupSprites(0,false); //16x16 no zoom
  VPRINT(0,2, "SetSpritesSize(0) SPRITES 8x8");
  SetSpritesSize(0);
  SetSpritesZoom(false);  
  showSprites(0);
  WAIT(100);
  
  // test sprites 16x16
  //setupSprites(1,false);
  VPRINT(0,3, "SetSpritesSize(1) SPRITES 16x16");
  SetSpritesSize(1);
  showSprites(2);
  WAIT(100);
 
  // test sprites 16x16 + zoom  
  //setupSprites(1,true);
  VPRINT(0,4, "SetSpritesZoom(true) SPRITES x2");
  SetSpritesZoom(true);
  //WAIT(100);

}



// TEST PUTSPRITE  #############################################################
void showSprites(char offset)
{
  char X=0,Y=3;
  char i=0;
  
  for(i=0;i<8;i++)
  {
    PUTSPRITE(i, X*32, Y*32, sprcol[i], i+offset);
    X++;
    if(X==4)
    {
      X=0;
      Y++;
    }
  }

  return;
}



void PUTSPRITE(char plane, char x, char y, char color, char pattern)
{

  uint vaddr;
  
  vaddr = BASE8 + (plane *4);  //OAM = BASE8 = BASE13 
  
  VPOKE(vaddr++,y);
  VPOKE(vaddr++,x);
  if (isSPRITE16px()>0) pattern=pattern*4;
  VPOKE(vaddr++,pattern);
  VPOKE(vaddr,color);  
}


char isSPRITE16px()
{
  return PEEK(RG0SAV+1) & 2;
}


